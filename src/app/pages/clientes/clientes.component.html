<section class="page-section" *ngIf="vm$ | async as vm">
  <header class="page-header">
    <div>
      <h2 class="page-title">Clientes</h2>
      <p class="page-subtitle">Gerencie cadastro de clientes vinculados aos chamados.</p>
    </div>
    <span class="status-chip">Total: {{ vm.clientes.length }}</span>
  </header>

  <div class="grid-2" *ngIf="vm.carregando">
    <div class="skeleton" style="min-height: 310px;"></div>
    <div class="skeleton" style="min-height: 310px;"></div>
  </div>

  <div class="clientes-layout" *ngIf="!vm.carregando">
    <article class="card clientes-col clientes-form-col">
      <div class="card-title-row">
        <div>
          <h3 class="card-title">Novo cliente</h3>
          <p class="card-subtitle">Dados basicos para identificacao e contato.</p>
        </div>
      </div>

      <form class="form clientes-form" (ngSubmit)="cadastrar()">
        <label>
          <span>Nome</span>
          <input name="nome" type="text" [(ngModel)]="nome" required />
        </label>
        <label>
          <span>Telefone</span>
          <input name="telefone" type="text" [(ngModel)]="telefone" placeholder="Opcional" />
        </label>
        <label>
          <span>Email</span>
          <input name="email" type="email" [(ngModel)]="email" placeholder="Opcional" />
        </label>
        <label>
          <span>Observacao</span>
          <textarea name="observacao" rows="3" [(ngModel)]="observacao" placeholder="Opcional"></textarea>
        </label>

        <div class="clientes-form-actions">
          <button class="btn primary" type="submit">Salvar cliente</button>
        </div>
      </form>
    </article>

    <article class="card clientes-col clientes-list-col">
      <div class="card-title-row">
        <div>
          <h3 class="card-title">Lista de clientes</h3>
          <p class="card-subtitle">Edite ou remova cadastros existentes.</p>
        </div>
      </div>

      <div class="empty-state" *ngIf="!!vm.erro">{{ vm.erro }}</div>

      <div class="clientes-list-scroll" *ngIf="!vm.erro">
        <table class="table clientes-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Contato</th>
              <th>Acoes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="vm.clientes.length === 0">
              <td colspan="3">Nenhum cliente cadastrado.</td>
            </tr>
            <tr *ngFor="let item of vm.clientes">
              <td>{{ item.nome }}</td>
              <td class="cliente-contato">
                <div>{{ item.telefone || "-" }}</div>
                <div>{{ item.email || "-" }}</div>
              </td>
              <td>
                <div class="btn-group">
                  <button class="btn secondary" type="button" (click)="abrirEdicao(item)">
                    Editar
                  </button>
                  <button class="btn danger" type="button" (click)="excluir(item)">
                    Excluir
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </article>
  </div>

  <div class="modal" *ngIf="editando">
    <div class="modal-content">
      <h3>Editar cliente</h3>
      <form class="form" (ngSubmit)="salvarEdicao()">
        <label>
          <span>Nome</span>
          <input name="editNome" type="text" [(ngModel)]="editNome" required />
        </label>
        <label>
          <span>Telefone</span>
          <input name="editTelefone" type="text" [(ngModel)]="editTelefone" />
        </label>
        <label>
          <span>Email</span>
          <input name="editEmail" type="email" [(ngModel)]="editEmail" />
        </label>
        <label>
          <span>Observacao</span>
          <textarea name="editObservacao" rows="3" [(ngModel)]="editObservacao"></textarea>
        </label>
        <div class="modal-actions">
          <button class="btn" type="button" (click)="cancelarEdicao()">Cancelar</button>
          <button class="btn primary" type="submit">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</section>
