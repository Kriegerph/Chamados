<div class="grid-4">
  <div class="card mini">
    <div class="card-title">Chamados do dia</div>
    <div class="card-value">{{ stats.totalDia }}</div>
    <div class="card-sub">
      {{ stats.concluidosHoje }} concluídos / {{ stats.abertosHoje }} abertos
    </div>
  </div>
  <div class="card mini">
    <div class="card-title">Total do mês</div>
    <div class="card-value">{{ stats.totalMes }}</div>
  </div>
  <div class="card mini">
    <div class="card-title">Total do ano</div>
    <div class="card-value">{{ stats.totalAno }}</div>
  </div>
  <div class="card mini">
    <div class="card-title">Total geral</div>
    <div class="card-value">{{ stats.totalGeral }}</div>
  </div>
</div>

<div class="card">
  <div class="dashboard-header">
    <h2>Totais por mês (ano atual)</h2>
    <button class="btn" type="button" (click)="carregar()">Atualizar</button>
  </div>
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Mês</th>
          <th>Quantidade</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let mes of meses; let i = index">
          <td>{{ mes }}</td>
          <td>{{ stats.totaisPorMes[i] || 0 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card" style="margin-top: 15px;">
  <div class="dashboard-header">
    <h2>Top clientes por número de chamados</h2>
    <div class="ranking-filters">
      <label>
        Período
        <select [(ngModel)]="rankingPeriodo" (change)="carregar()">
          <option value="hoje">Hoje</option>
          <option value="7dias">Últimos 7 dias</option>
          <option value="mes">Mês atual</option>
          <option value="ano">Ano atual</option>
          <option value="todos">Todos</option>
        </select>
      </label>
      <label>
        Status
        <select [(ngModel)]="rankingStatus" (change)="carregar()">
          <option value="todos">Todos</option>
          <option value="concluidos">Apenas concluídos</option>
        </select>
      </label>
    </div>
  </div>
  <div class="table-wrap">
    <table class="table" *ngIf="ranking.length > 0">
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Total</th>
          <th>Abertos</th>
          <th>Concluídos</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of ranking">
          <td>{{ item.nome }}</td>
          <td>{{ item.total }}</td>
          <td>{{ item.abertos }}</td>
          <td>{{ item.concluidos }}</td>
        </tr>
      </tbody>
    </table>
    <div class="empty" *ngIf="clientesTotal === 0">
      Nenhum cliente cadastrado. Cadastre clientes para vincular chamados e ver o ranking.
    </div>
    <div class="empty" *ngIf="clientesTotal > 0 && ranking.length === 0">
      Nenhum chamado encontrado para o filtro selecionado.
    </div>
  </div>
</div>
